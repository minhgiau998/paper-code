# Internationalization (i18n) Documentation

> **Purpose:** Adapting the application to different languages and regions without engineering changes.

## üì¶ Installation & Setup

{% if tech_stack | default("") and "Next.js" in tech_stack %}
### Next.js (App Router) -> `next-intl`
We use **next-intl** because it fully supports React Server Components (RSC).

```bash
npm install next-intl
```

**1. Configuration (`src/i18n.ts`):**
```typescript
import { notFound } from 'next/navigation';
import { getRequestConfig } from 'next-intl/server';

// Can be imported from a shared config file
const locales = ['en', 'vi', 'ja'];

export default getRequestConfig(async ({ locale }) => {
  // Validate that the incoming `locale` parameter is valid
  if (!locales.includes(locale as any)) notFound();

  return {
    messages: (await import(`../messages/${locale}.json`)).default
  };
});
```

**2. Middleware (`src/middleware.ts`):**
```typescript
import createMiddleware from 'next-intl/middleware';

export default createMiddleware({
  locales: ['en', 'vi', 'ja'],
  defaultLocale: 'en'
});

export const config = {
  // Match only internationalized pathnames
  matcher: ['/', '/(vi|en|ja)/:path*']
};
```

{% elif "Vue" in tech_stack or "Nuxt" in tech_stack %}
### Vue 3 / Nuxt -> `vue-i18n`

```bash
npm install vue-i18n
# If Nuxt:
npm install @nuxtjs/i18n
```

**Configuration (`src/i18n.ts`):**
```typescript
import { createI18n } from 'vue-i18n'
import en from './locales/en.json'
import vi from './locales/vi.json'

const i18n = createI18n({
  legacy: false, // Must be false for Composition API
  locale: 'en',
  fallbackLocale: 'en',
  messages: { en, vi }
})

export default i18n
```

{% else %}
### React / React Native -> `react-i18next`

The standard library for the React ecosystem.

```bash
npm install i18next react-i18next i18next-browser-languagedetector
```

**Configuration (`src/lib/i18n.ts`):**
```typescript
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';

import en from '@/locales/en.json';
import vi from '@/locales/vi.json';

i18n
  .use(LanguageDetector)
  .use(initReactI18next)
  .init({
    resources: {
      en: { translation: en },
      vi: { translation: vi },
    },
    lng: "en", // Default language
    fallbackLng: "en",
    interpolation: {
      escapeValue: false // React already escapes values
    }
  });

export default i18n;
```
{% endif %}

## üõ°Ô∏è Type Safety (Critical Strategy)

**Rule:** You MUST configure TypeScript to recognize your translation keys. This prevents typos like `t('hme')` instead of `t('home')`.

{% if tech_stack | default("") and "Next.js" in tech_stack %}
**File:** `src/global.d.ts`
```typescript
// Use the English file as the source of truth
type Messages = typeof import('../messages/en.json');
declare interface IntlMessages extends Messages {}
```
{% elif "Vue" in tech_stack %}
**Strategy:** `vue-i18n` supports type inference if configured in `tsconfig.json` or using the `Schema` definition in `createI18n`.
{% else %}
**File:** `src/types/i18next.d.ts`
```typescript
import 'i18next';
import en from '@/locales/en.json';

declare module 'i18next' {
  interface CustomTypeOptions {
    defaultNS: 'translation';
    resources: {
      translation: typeof en;
    };
  }
}
```
{% endif %}

## üíª Usage Patterns

### 1. JSON Structure (Nested)
**Rule:** Use nested keys to organize translations by feature or page.

**File:** `locales/en.json`
```json
{
  "common": {
    "save": "Save",
    "cancel": "Cancel"
  },
  "auth": {
    "login": {
      "title": "Welcome Back",
      "subtitle": "Please sign in to continue"
    }
  }
}
```

### 2. Implementation

{% if tech_stack | default("") and "Next.js" in tech_stack %}
```tsx
import { useTranslations } from 'next-intl';

export default function LoginPage() {
  const t = useTranslations('auth.login');

  return (
    <div>
      <h1>{t('title')}</h1>
      <button>{t('common.save')}</button> <!-- Error if namespace not loaded -->
    </div>
  );
}
```

{% elif "Vue" in tech_stack %}
{% raw %}
```vue
<script setup>
import { useI18n } from 'vue-i18n'
const { t } = useI18n()
</script>

<template>
  <button>{{ t('common.save') }}</button>
</template>
```
{% endraw %}

{% else %}
```tsx
import { useTranslation } from 'react-i18next';

export const SaveButton = () => {
  const { t } = useTranslation();
  return <button>{t('common.save')}</button>;
}
```
{% endif %}

### 3. Interpolation (Dynamic Values)
**Rule:** Never concatenate strings for translations. Grammar varies by language.

**JSON:**
```json
{
  "greeting": "Hello, {name}!" 
}
```

**Usage:**
```tsx
// React / Next
t('greeting', { name: 'John' })
```

## üö´ Anti-Patterns to Avoid

1.  **String Concatenation:**
    *   **Bad:** `t('welcome') + ' ' + userName`
    *   **Good:** `t('welcome', { name: userName })` (Let the library handle positioning).

2.  **Hardcoded Fallbacks:**
    *   **Bad:** `t('key') || 'Default Text'`
    *   **Reason:** If the key is missing, the user sees "key" in production, or the fallback hides the issue. The Type Safety rule should catch this at build time.

3.  **Keys as English Text:**
    *   **Bad:** `t('Hello World this is a long sentence')`
    *   **Good:** `t('home.hero_text')`
    *   **Reason:** If you change the English text, you break the key for all other languages. Keep logic (keys) separate from content (values).

## üõ†Ô∏è Tooling
- **VS Code Extension:** Install **i18n Ally**. It shows the translation inline in your code editor so you don't have to jump between files.