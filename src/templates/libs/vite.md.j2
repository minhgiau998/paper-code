# Vite Documentation

> **Purpose:** Next Generation Frontend Tooling. Instant Server Start, Lightning Fast HMR (Hot Module Replacement).

## üì¶ Installation

Typically initialized via `npm create vite@latest`.
If adding manually or updating:

```bash
npm install -D vite
{% if tech_stack | default("") and "React" in tech_stack %}
npm install -D @vitejs/plugin-react
{% elif tech_stack | default("") and "Vue" in tech_stack %}
npm install -D @vitejs/plugin-vue
{% elif tech_stack | default("") and "Svelte" in tech_stack %}
npm install -D @sveltejs/vite-plugin-svelte
{% endif %}
```

## üõ†Ô∏è Configuration (`vite.config.ts`)

**Strategy:** Keep config minimal but functional. We enforce **Path Aliases** and **API Proxying** here.

```typescript
import { defineConfig, loadEnv } from 'vite';
import path from 'path';

// ‚¨áÔ∏è Framework-Specific Plugin Imports
{% if tech_stack | default("") and "React" in tech_stack %}
import react from '@vitejs/plugin-react';
{% elif tech_stack | default("") and "Vue" in tech_stack %}
import vue from '@vitejs/plugin-vue';
{% elif tech_stack | default("") and "Svelte" in tech_stack %}
import { svelte } from '@sveltejs/vite-plugin-svelte';
{% endif %}

// https://vitejs.dev/config/
export default defineConfig(({ mode }) => {
  // Load env file based on `mode` in the current working directory.
  const env = loadEnv(mode, process.cwd(), '');

  return {
    plugins: [
      {% if tech_stack | default("") and "React" in tech_stack %}
      react(),
      {% elif tech_stack | default("") and "Vue" in tech_stack %}
      vue(),
      {% elif tech_stack | default("") and "Svelte" in tech_stack %}
      svelte(),
      {% endif %}
    ],
    
    // üìÇ Path Aliases (Must match tsconfig.json paths)
    resolve: {
      alias: {
        '@': path.resolve(__dirname, './src'),
      },
    },

    // üîó Dev Server Proxy (CORS Solution)
    // Redirects /api requests to your Backend during development
    server: {
      port: 5173,
      proxy: {
        '/api': {
          target: env.VITE_API_URL || 'http://localhost:3000',
          changeOrigin: true,
          secure: false,
          // rewrite: (path) => path.replace(/^\/api/, ''), // Enable if backend doesn't expect /api prefix
        },
      },
    },

    // üèóÔ∏è Build Optimization
    build: {
      outDir: 'dist',
      sourcemap: mode !== 'production', // Disable source maps in prod
      rollupOptions: {
        output: {
          // Manual Chunks strategy to split vendor code
          manualChunks: (id) => {
            if (id.includes('node_modules')) {
              return 'vendor';
            }
          },
        },
      },
    },
  };
});
```

## üõ°Ô∏è Best Practices & Strategies

### 1. Environment Variables
**Rule:** Vite exposes env vars on the special `import.meta.env` object.
**Rule:** Only variables prefixed with `VITE_` are exposed to the client to prevent leaking server secrets.

```typescript
// .env
VITE_API_URL=http://localhost:3000

// src/config.ts
console.log(import.meta.env.VITE_API_URL); // ‚úÖ Works
console.log(process.env.DB_PASSWORD);      // ‚ùå Undefined (Safe)
```

### 2. TypeScript Integration (`vite-env.d.ts`)
Ensure your `src/vite-env.d.ts` (or `env.d.ts`) includes the client reference types. This allows TS to understand importing images (`.png`, `.svg`) and `import.meta.env`.

```typescript
/// <reference types="vite/client" />

interface ImportMetaEnv {
  readonly VITE_API_URL: string;
  // Add other vars here
}

interface ImportMeta {
  readonly env: ImportMetaEnv;
}
```

### 3. Static Assets
**Rule:**
- **Public Folder (`/public`):** Use for files that should not be processed (e.g., `robots.txt`, `favicon.ico`). Accessed as `/robots.txt`.
- **Source Folder (`/src/assets`):** Use for images/fonts that are imported in code. Vite will hash them for cache busting (`assets/logo.2d3f.png`).

## üö´ Anti-Patterns to Avoid

1.  **Using `require()`:**
    *   Vite is built on **ES Modules (ESM)**. `require()` is CommonJS.
    *   **Bad:** `const img = require('./img.png')`
    *   **Good:** `import img from './img.png'`

2.  **Hardcoding Proxy URLs:**
    *   Do not hardcode `http://localhost:3000` in your `fetch` calls.
    *   Use the Proxy (`/api/...`) or the `VITE_API_URL` environment variable.

3.  **Barrel Files in Dev:**
    *   Avoid huge "barrel" files (`index.ts` exporting 100+ components).
    *   In Development, Vite has to fetch all of them individually, which can slow down startup. Import directly if startup is slow.

## üìù Troubleshooting

- **CORS Errors:** Check `server.proxy` configuration.
- **"process is not defined":** You are using a library meant for Node.js in the browser. Polyfill it or use a browser-compatible alternative.
- **HMR not working:** Check if the file name casing matches the import (Windows/macOS are case-insensitive, Linux is strict).