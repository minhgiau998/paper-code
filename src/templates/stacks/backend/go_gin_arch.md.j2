# Go (Gin) Project Architecture

## ðŸ—ï¸ High-Level Overview

This project is a high-performance HTTP REST API built with **Go** and the **Gin Web Framework**.
It follows the **Standard Go Project Layout** and implements **Clean Architecture** to separate Transport (HTTP), Business Logic (Service), and Data Access (Repository).

## ðŸ“‚ Directory Structure

We strictly adhere to the `internal/` pattern to enforce encapsulation.

```text
root/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go          # Application Entry Point
â”œâ”€â”€ config/                  # Configuration files (YAML/JSON)
â”œâ”€â”€ internal/                # Private Application Code
â”‚   â”œâ”€â”€ api/                 # Transport Layer
â”‚   â”‚   â”œâ”€â”€ handlers/        # Gin Handlers (Controllers)
â”‚   â”‚   â”œâ”€â”€ middleware/      # Gin Middlewares
â”‚   â”‚   â””â”€â”€ routes/          # Route definitions
â”‚   â”œâ”€â”€ core/                # Domain Layer
â”‚   â”‚   â”œâ”€â”€ domain/          # Structs/Entities
â”‚   â”‚   â””â”€â”€ ports/           # Interfaces (Service/Repository contracts)
â”‚   â”œâ”€â”€ service/             # Business Logic Layer
â”‚   â””â”€â”€ repository/          # Data Access Layer
{% if "Gorm" in libraries %}
â”‚       â””â”€â”€ models/          # GORM Models
{% endif %}
â”œâ”€â”€ pkg/                     # Public Shared Libraries (Utils, Logger)
â”‚   â”œâ”€â”€ logger/
â”‚   â””â”€â”€ validator/
â”œâ”€â”€ go.mod
â””â”€â”€ go.sum
```

## ðŸ§© Key Architectural Patterns

### 1. Clean Architecture (Layers)
Data flows strictly from outer layers to inner layers via Interfaces.
1.  **Handler (API):** Parses HTTP request, validates input (`c.ShouldBind`), calls Service.
2.  **Service (Business):** Contains logic. Agnostic of HTTP. Accepts and returns Domain Structs.
3.  **Repository (Data):** Talks to DB/External APIs. Returns Domain Structs.

### 2. Dependency Injection (DI)
We do not use global state. All dependencies are injected via **Constructor Injection**.
```go
// Example
func NewUserHandler(svc ports.UserService) *UserHandler {
    return &UserHandler{service: svc}
}
```
In `main.py`, we wire up the application: `Repo -> Service -> Handler`.

### 3. Context Propagation
**Critical:** `context.Context` must be passed through every layer, from Handler to Database.
- This ensures request cancellation and timeouts work correctly.
- Gin's context (`c`) contains the standard context: `ctx := c.Request.Context()`.

{% if "Viper" in libraries %}
### 4. Configuration (Viper)
- **Viper** is used to load configuration from environment variables and config files (`config.yaml`).
- Config is loaded once at startup and passed to dependencies.
{% endif %}

{% if "Gorm" in libraries %}
### 5. Database (GORM)
- We use **GORM** for ORM capabilities.
- The `repository` layer wraps GORM calls.
- **Transaction Boundary:** Transactions should be managed at the Service layer (if possible) or Repository layer.
{% endif %}

## ðŸ”’ Security Architecture
- **Graceful Shutdown:** The server handles `SIGTERM`/`SIGINT` to finish active requests before closing.
- **Middleware:**
  - `Recovery`: Catches panics.
  - `Logger`: Logs requests.
  - `CORS`: Restricts origins.