# Node.js Project Architecture

## ðŸ—ï¸ High-Level Overview

This project is a **Backend Application** built with **Node.js**.
{% if libraries | default([]) | select("in", ["NestJS"]) | list | length > 0 %}
It utilizes **NestJS**, following a strictly modular, Angular-inspired architecture with Dependency Injection.
{% elif libraries | default([]) | select("in", ["Fastify"]) | list | length > 0 %}
It uses **Fastify** for high-performance processing, structured around a plugin-based architecture.
{% else %}
It uses **Express.js** (or standard HTTP), following a classic **Layered Architecture** (Controller-Service-Repository) to separate concerns.
{% endif %}

We strictly adhere to **ES Modules** (`import`/`export`) and **TypeScript** (if configured) for modern, type-safe development.

## ðŸ“‚ Directory Structure

{% if libraries | default([]) | select("in", ["NestJS"]) | list | length > 0 %}
### NestJS Structure
```text
src/
â”œâ”€â”€ app.module.ts        # Root Module
â”œâ”€â”€ main.ts              # Entry Point
â”œâ”€â”€ common/              # Global pipes, guards, filters, decorators
â”‚   â”œâ”€â”€ decorators/
â”‚   â”œâ”€â”€ filters/
â”‚   â””â”€â”€ guards/
â”œâ”€â”€ config/              # Configuration (Env variables)
â””â”€â”€ modules/             # Feature Modules (Domain Logic)
    â”œâ”€â”€ auth/
    â”‚   â”œâ”€â”€ auth.controller.ts
    â”‚   â”œâ”€â”€ auth.service.ts
    â”‚   â””â”€â”€ auth.module.ts
    â””â”€â”€ users/
        â”œâ”€â”€ dto/         # Data Transfer Objects
        â”œâ”€â”€ entities/    # DB Entities
        â””â”€â”€ users.service.ts
```

{% else %}
### Layered Structure (Express/Fastify)
```text
src/
â”œâ”€â”€ app.ts               # App setup (Middleware, Routes)
â”œâ”€â”€ server.ts            # Entry Point (Server Listen)
â”œâ”€â”€ config/              # Environment config
â”œâ”€â”€ controllers/         # Request Handlers (Input/Output)
â”œâ”€â”€ services/            # Business Logic
â”œâ”€â”€ routes/              # Route Definitions
â”œâ”€â”€ middleware/          # Custom Middleware (Auth, Logging)
â”œâ”€â”€ utils/               # Helper functions
â”œâ”€â”€ types/               # TypeScript Definitions
{% if libraries | default([]) | select("in", ["Prisma", "TypeORM", "Mongoose"]) | list | length > 0 %}
â”œâ”€â”€ data-access/         # Database Layer (Repositories/DAO)
â”‚   â””â”€â”€ db.client.ts
{% endif %}
â””â”€â”€ tests/               # Test files
```
{% endif %}

## ðŸ§© Key Architectural Patterns

### 1. Separation of Concerns
{% if libraries | default([]) | select("in", ["NestJS"]) | list | length > 0 %}
- **Modules:** Organize code by feature (Domain), not technical role.
- **Controllers:** Handle HTTP requests and DTO validation.
- **Services:** Contain business logic.
- **Providers/Repositories:** Handle data access.
{% else %}
- **Controllers:** Parse the request (`req.body`), call the Service, and send the response (`res.json`). **No business logic here.**
- **Services:** Pure business logic. Agnostic of HTTP (should not know what `req` or `res` is).
- **Data Access:** SQL/NoSQL queries live here (or in ORM models).
{% endif %}

### 2. Error Handling
- **Global Error Handler:** Never send raw errors to the client. Use a global middleware (Express/Fastify) or Exception Filter (NestJS) to sanitize errors.
- **Async Handling:**
  - **Express:** Use `express-async-errors` or wrap handlers to catch rejected Promises.
  - **NestJS/Fastify:** Built-in async error handling is active.

{% if libraries | default([]) | select("in", ["Prisma", "TypeORM", "Mongoose"]) | list | length > 0 %}
{% raw %}
### 3. Database Layer
- Database logic is decoupled from Controllers.
- We use **{{ libraries | default([]) | select("in", ["Prisma", "TypeORM", "Mongoose"]) | first | default("ORM") }}** to interact with the database.
- Database connections are initialized once at startup (`server.ts` or `AppModule`).
{% endraw %}
{% endif %}

## ðŸ”’ Security Architecture
- **Helmet:** Used to set secure HTTP headers.
- **CORS:** Strictly configured to allow only specific origins.
- **Rate Limiting:** Applied to prevent abuse (e.g., `express-rate-limit` or `@nestjs/throttler`).