# FastAPI Project Architecture

## ðŸ—ï¸ High-Level Overview

This project is a high-performance, asynchronous REST API built with **FastAPI**.
It leverages **Python 3.10+** type hints for validation and documentation.

## ðŸ“‚ Directory Structure

The project follows a **Production-Ready** application structure (not a single-file script).

```text
app/
â”œâ”€â”€ api/                 # API Route Handlers
â”‚   â”œâ”€â”€ api_v1/          # Versioning
â”‚   â”‚   â”œâ”€â”€ endpoints/   # Route modules (users, items)
â”‚   â”‚   â””â”€â”€ api.py       # Router aggregator
â”‚   â””â”€â”€ deps.py          # Global dependencies (get_current_user, get_db)
â”œâ”€â”€ core/                # Core Configuration
â”‚   â”œâ”€â”€ config.py        # Pydantic Settings
â”‚   â””â”€â”€ security.py      # JWT/Auth logic
â”œâ”€â”€ models/              # Database Models (ORM)
â”‚   â”œâ”€â”€ base.py          # Base declarative class
â”‚   â””â”€â”€ user.py
â”œâ”€â”€ schemas/             # Pydantic Models (Data Validation)
â”‚   â”œâ”€â”€ user.py          # UserCreate, UserUpdate, UserResponse
â”‚   â””â”€â”€ token.py
â”œâ”€â”€ services/            # Business Logic Layer (Optional but Recommended)
â”‚   â””â”€â”€ user_service.py
{% if libraries | default([]) | select("in", ["SQLAlchemy"]) | list | length > 0 %}
â”œâ”€â”€ db/                  # Database Components
â”‚   â”œâ”€â”€ session.py       # Engine & Session factory
â”‚   â””â”€â”€ base.py          # Import all models here for Alembic
{% endif %}
â”œâ”€â”€ main.py              # App Entry Point
â””â”€â”€ tests/               # Pytest Suite
    â”œâ”€â”€ conftest.py      # Test fixtures
    â””â”€â”€ api/
{% if libraries | default([]) | select("in", ["Alembic"]) | list | length > 0 %}
alembic/                 # Database Migrations
alembic.ini
{% endif %}
```

## ðŸ§© Key Architectural Patterns

### 1. Dependency Injection
FastAPI's dependency injection system (`Depends`) is the backbone of the architecture.
- **Usage:** Use it for Database Sessions, Authentication, and Shared Logic.
- **Scope:** Dependencies are per-request by default.

### 2. Pydantic v2 (Validation)
We strictly use **Pydantic v2** for schemas (DTOs).
- **Schemas (`app/schemas`):** Define what the API expects (Input) and returns (Output).
- **Separation:** Never return raw ORM models directly; always map them to Pydantic schemas using `response_model`.

{% if libraries | default([]) | select("in", ["SQLAlchemy"]) | list | length > 0 %}
### 3. Database Layer (SQLAlchemy 2.0)
- **Async:** We use `AsyncSession` and `async/await` for all DB interactions.
- **Pattern:** Use the **Repository Pattern** or **Service Layer** to isolate DB queries from Route logic.
- **Migrations:** Managed by **Alembic**.
{% endif %}

{% if libraries | default([]) | select("in", ["Celery"]) | list | length > 0 %}
### 4. Background Tasks (Celery)
- Heavy operations (Email sending, Image processing) must be offloaded to Celery workers.
- The API should only enqueue the task and return a status immediately.
{% endif %}

## ðŸ”’ Security Architecture
- **OAuth2:** Implemented via `OAuth2PasswordBearer`.
- **JWT:** Stateless authentication using JSON Web Tokens.
- **CORS:** Configured in `main.py` to restrict origins.