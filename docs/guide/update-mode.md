# Update Mode

Safely update existing documentation while preserving your customizations.

## Overview

Update mode allows you to regenerate documentation for an existing project without losing your custom changes. PAPER-CODE intelligently:

1. Detects existing documentation
2. Analyzes what you've customized
3. Merges updates with your changes
4. Preserves your modifications

## Basic Usage

Update documentation for existing project:

```bash
paper-code update --project ./my-project
```

PAPER-CODE will:

1. Detect the project structure
2. Ask which files to update
3. Merge changes intelligently
4. Create a backup (optional)

## How It Works

### Auto-Detection

PAPER-CODE examines your project to detect:

- `package.json` → Frontend/Node.js project
- `requirements.txt` → Python project
- `go.mod` → Go project
- `Cargo.toml` → Rust project
- Existing `ARCHITECTURE.md` → Current stack

### Conflict Resolution

#### Section-Based Merging

```markdown
# README.md

## Features

<!-- PAPER-CODE START: AUTO-GENERATED -->

- Built with React
- Uses TypeScript
<!-- PAPER-CODE END: AUTO-GENERATED -->

## Custom Features

This section is never overwritten

- My custom feature
- Organization-specific config
```

PAPER-CODE only updates sections marked with `PAPER-CODE START/END` comments.

#### Front Matter Metadata

```yaml
---
title: Architecture
generated: 2024-01-13
stack: React
# Custom metadata preserved
team: frontend-team
last-reviewed: 2024-01-10
---
Content here...
```

## Update Strategies

### Strategy 1: Full Replacement

Replace entire file but keep backups:

```bash
paper-code update --project ./my-project --strategy replace --backup
```

Creates backup:

```
docs/
├── ARCHITECTURE.md          # New version
├── ARCHITECTURE.md.backup   # Old version
└── .paper-code/
    └── ARCHITECTURE.md.2024-01-13  # Historical backup
```

### Strategy 2: Section Merge

Update only auto-generated sections:

```bash
paper-code update --project ./my-project --strategy merge
```

Preserves your custom sections:

```markdown
# README.md

<!-- PAPER-CODE START: AUTO-GENERATED -->

[Updated automatically]

<!-- PAPER-CODE END: AUTO-GENERATED -->

<!-- CUSTOM SECTION -->

[Your modifications preserved]

<!-- CUSTOM SECTION END -->
```

### Strategy 3: Interactive

Review each change interactively:

```bash
paper-code update --project ./my-project --strategy interactive
```

For each file:

```
Update ARCHITECTURE.md?
  View diff (d)
  Accept changes (y)
  Skip update (n)
  Edit merge manually (e)
  >
```

## Marking Custom Sections

### Automatic Markers

Add markers to preserve sections:

```markdown
# Architecture

## Auto-Generated Section

<!-- PAPER-CODE START -->

Content auto-generated by PAPER-CODE

<!-- PAPER-CODE END -->

## Custom Architecture Decisions

<!-- CUSTOM: Do not auto-generate this section -->

Our team decided to use microservices because...

<!-- CUSTOM END -->
```

### YAML Front Matter

```yaml
---
stack: React
generated-by: paper-code
generated-date: 2024-01-13
update-strategy: merge
preserve-sections:
  - "## Custom Implementation Notes"
  - "## Team Decisions"
---
```

## Workflow Examples

### Quarterly Updates

Keep documentation fresh without losing improvements:

```bash
# Quarterly documentation refresh
paper-code update --project ./my-project \
  --strategy merge \
  --backup \
  --interactive

# Review changes
git diff docs/

# Commit updates
git add docs/
git commit -m "docs: quarterly documentation update"
```

### Stack Upgrade

Update documentation when upgrading framework:

```bash
# Upgrading from React 18 to 19
paper-code update --project ./my-project \
  --stack "React" \
  --libraries "React@19,TypeScript"
```

### CI/CD Integration

Automatically update docs on version bump:

```yaml
name: Update Docs on Release

on:
  release:
    types: [published]

jobs:
  update-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
      - run: pip install paper-code
      - run: paper-code update --project . --strategy merge
      - run: |
          git add docs/
          git commit -m "docs: update for release ${{ github.event.release.tag_name }}" || true
          git push
```

## Conflict Detection

### Automatic Conflict Detection

```bash
paper-code update --project ./my-project --detect-conflicts
```

Output shows:

```
Analyzing changes...
✅ CONTRIBUTING.md - No conflicts
⚠️  ARCHITECTURE.md - Potential conflicts detected
❌ CODE_STANDARDS.md - Conflicts found

Review conflicts with: paper-code update --project . --review ARCHITECTURE.md
```

### Manual Conflict Resolution

When conflicts are detected:

```bash
paper-code update --project ./my-project --resolve-conflicts
```

Interactive conflict resolution:

```
Conflict in ARCHITECTURE.md (line 24-30)

CURRENT (in your file):
>>>>>>> HEAD
## Data Flow
Our custom implementation with Redux...
=======

UPDATED (from template):
## Data Flow
Standard React data flow with Context API...
<<<<<<< UPDATED

Choose:
  (y) Use current version
  (u) Use updated version
  (m) Manual merge
  (d) Show detailed diff
  >
```

## Backup and Recovery

### Automatic Backups

```bash
paper-code update --project . --backup
```

Backups stored in `.paper-code/backups/`:

```
.paper-code/
└── backups/
    ├── 2024-01-13_10-30-45/
    │   ├── ARCHITECTURE.md
    │   ├── README.md
    │   └── CODE_STANDARDS.md
    └── 2024-01-10_14-22-10/
```

### Restore from Backup

```bash
paper-code update --project . --restore 2024-01-13_10-30-45
```

### View Backup Versions

```bash
paper-code backup list --project .
```

Output:

```
Available backups:
1. 2024-01-13_10-30-45 (Today)
2. 2024-01-10_14-22-10 (3 days ago)
3. 2024-01-01_09-15-30 (12 days ago)
```

## Diff and Review

### View Changes Before Updating

```bash
paper-code update --project . --dry-run
```

Shows what would change without writing files:

```
Would update:
  ✓ docs/ARCHITECTURE.md (+5 lines, -2 lines)
  ✓ docs/CODE_STANDARDS.md (no changes)
  ✓ docs/README.md (+1 line, -1 line)
```

### Detailed Diff

```bash
paper-code update --project . --diff
```

Shows:

```
--- Current ARCHITECTURE.md
+++ Updated ARCHITECTURE.md

@@ -24,7 +24,8 @@
  ## Data Flow

- Our custom Redux implementation
+ Standard React Context API flow

  ### State Management
```

## Best Practices

1. **Regular Updates:** Run updates quarterly
2. **Version Control:** Always commit before updates
3. **Review Changes:** Use `--dry-run` before applying
4. **Backup Consistently:** Enable automatic backups
5. **Mark Custom Sections:** Use markers for your content
6. **Document Decisions:** Preserve team rationale

## Troubleshooting

### Update Fails with Conflicts

```bash
# View detailed conflict report
paper-code update --project . --report

# Manually merge using interactive mode
paper-code update --project . --strategy interactive
```

### Lost Custom Changes

Restore from backup:

```bash
paper-code backup list --project .
paper-code update --project . --restore {backup-id}
```

### Template Version Mismatch

Update to latest templates:

```bash
pip install --upgrade paper-code
paper-code update --project . --latest
```

---

For more information, see [CLI Usage](./cli-usage.md) or [Batch Mode](./batch-mode.md).
